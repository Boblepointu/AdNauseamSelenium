version: '3.8'

# Docker Swarm Stack for AdNauseam Browser Automation
# Maintains browser version diversity for maximum TLS/HTTP/CSS fingerprint variation
# Uses pre-built images from GitHub Container Registry

services:
  # ============================================
  # SELENIUM HUB
  # ============================================
  selenium-hub:
    image: selenium/hub:latest
    ports:
      - target: 4444
        published: 4444
        protocol: tcp
        mode: ingress
      - target: 4442
        published: 4442
        protocol: tcp
        mode: ingress
      - target: 4443
        published: 4443
        protocol: tcp
        mode: ingress
    networks:
      - traefik-public
      - selenium-network
    environment:
      - GRID_MAX_SESSION=150
      - GRID_BROWSER_TIMEOUT=60
      - GRID_TIMEOUT=60
      - SE_SESSION_REQUEST_TIMEOUT=30
      - SE_NODE_SESSION_TIMEOUT=30
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
      resources:
        reservations:
          memory: 2G
      labels:
        - "traefik.enable=true"
        - "traefik.swarm.network=traefik-public"
        - "traefik.http.routers.selenium.rule=Host(`selenium.service.lotusia.org`)"
        - "traefik.http.routers.selenium.entrypoints=web"
        - "traefik.http.routers.selenium.middlewares=selenium-redirect"
        - "traefik.http.routers.selenium-secure.rule=Host(`selenium.service.lotusia.org`)"
        - "traefik.http.routers.selenium-secure.entrypoints=websecure"
        - "traefik.http.routers.selenium-secure.tls=true"
        - "traefik.http.routers.selenium-secure.tls.certresolver=letsencrypt"
        - "traefik.http.routers.selenium-secure.middlewares=auth@swarm"
        - "traefik.http.services.selenium.loadbalancer.server.port=4444"
        - "traefik.http.middlewares.selenium-redirect.redirectscheme.scheme=https"
        - "traefik.http.middlewares.selenium-redirect.redirectscheme.permanent=true"

  # ============================================
  # CHROME NODES - DIVERSE VERSIONS (Main Node)
  # ============================================
  chrome-95:
    image: selenium/node-chrome:95.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 5
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  chrome-110:
    image: selenium/node-chrome:110.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 5
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  chrome-120:
    image: selenium/node-chrome:120.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 10
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  chrome-125:
    image: selenium/node-chrome:125.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 10
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  chrome-130:
    image: selenium/node-chrome:130.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 10
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  chrome-latest:
    image: selenium/node-chrome:latest
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 5
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  chrome-beta:
    image: selenium/node-chrome:beta
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  chrome-dev:
    image: selenium/node-chrome:dev
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 3
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  # ============================================
  # FIREFOX NODES - DIVERSE VERSIONS (Main Node)
  # ============================================
  firefox-98:
    image: selenium/node-firefox:98.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  firefox-110:
    image: selenium/node-firefox:110.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  firefox-120:
    image: selenium/node-firefox:120.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  firefox-130:
    image: selenium/node-firefox:130.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  firefox-140:
    image: selenium/node-firefox:140.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  firefox-latest:
    image: selenium/node-firefox:latest
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  firefox-beta:
    image: selenium/node-firefox:beta
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  firefox-dev:
    image: selenium/node-firefox:dev
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  # ============================================
  # EDGE NODES - DIVERSE VERSIONS (Main Node)
  # ============================================
  edge-114:
    image: selenium/node-edge:114.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  edge-120:
    image: selenium/node-edge:120.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  edge-125:
    image: selenium/node-edge:125.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  edge-130:
    image: selenium/node-edge:130.0
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  edge-latest:
    image: selenium/node-edge:latest
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  edge-beta:
    image: selenium/node-edge:beta
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  edge-dev:
    image: selenium/node-edge:dev
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  # ============================================
  # CHROMIUM NODE (Main Node)
  # ============================================
  chromium-latest:
    image: selenium/node-chromium:latest
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  # ============================================
  # CHROME NODES - SLAVE NODE
  # ============================================
  chrome-slave:
    image: selenium/node-chrome:latest
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 3
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  # ============================================
  # FIREFOX NODES - SLAVE NODE
  # ============================================
  firefox-slave:
    image: selenium/node-firefox:latest
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 3
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  # ============================================
  # EDGE NODES - SLAVE NODE
  # ============================================
  edge-slave:
    image: selenium/node-edge:latest
    networks:
      - selenium-network
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=300
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_OTEL_TRACES_EXPORTER=none
      - SE_ENABLE_TRACING=false
    shm_size: 2gb
    deploy:
      replicas: 6
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
      resources:
        reservations:
          memory: 2G

  # ============================================
  # BROWSER AUTOMATION - MAIN NODE
  # Using pre-built GHCR image with all dependencies included
  # ============================================
  browser-automation-main:
    image: ghcr.io/boblepointu/adnauseamselenium:latest
    networks:
      - selenium-network
    volumes:
      - personas-data:/app/data/personas
    environment:
      - SELENIUM_HUB=selenium-hub:4444
      - PERSONA_ROTATION_STRATEGY=weighted
      - PERSONA_MAX_AGE_DAYS=30
      - PERSONA_MAX_USES=100
    deploy:
      replicas: 10
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 10
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
      update_config:
        parallelism: 2
        delay: 10s
        order: start-first

  # ============================================
  # BROWSER AUTOMATION - SLAVE NODE
  # Using pre-built GHCR image with all dependencies included
  # ============================================
  browser-automation-slave:
    image: ghcr.io/boblepointu/adnauseamselenium:latest
    networks:
      - selenium-network
    volumes:
      - personas-data:/app/data/personas
    environment:
      - SELENIUM_HUB=selenium-hub:4444
      - PERSONA_ROTATION_STRATEGY=random
      - PERSONA_MAX_AGE_DAYS=30
      - PERSONA_MAX_USES=100
    deploy:
      replicas: 20
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 10
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
      update_config:
        parallelism: 5
        delay: 10s
        order: start-first

  # ============================================
  # BROWSER AUTOMATION - ROUND-ROBIN STRATEGY
  # Using pre-built GHCR image with all dependencies included
  # ============================================
  browser-automation-roundrobin:
    image: ghcr.io/boblepointu/adnauseamselenium:latest
    networks:
      - selenium-network
    volumes:
      - personas-data:/app/data/personas
    environment:
      - SELENIUM_HUB=selenium-hub:4444
      - PERSONA_ROTATION_STRATEGY=round-robin
      - PERSONA_MAX_AGE_DAYS=30
      - PERSONA_MAX_USES=100
    deploy:
      replicas: 10
      placement:
        constraints:
          - node.hostname == testnetslaveportainer
      restart_policy:
        condition: on-failure
        delay: 10s
        max_attempts: 10
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
      update_config:
        parallelism: 3
        delay: 10s
        order: start-first

networks:
  traefik-public:
    external: true
  selenium-network:
    driver: overlay
    attachable: true

volumes:
  personas-data:
    driver: local
